# bkit v1.5.0 Plan: Claude Code 2.1.19 통합

> **생성일**: 2026-01-24
> **목표 버전**: bkit v1.5.0
> **Claude Code 버전**: 2.1.19+

---

## 1. 개요

### 1.1 배경

Claude Code 2.1.17 → 2.1.19 업그레이드에서 발견된 개선 기회를 bkit v1.5.0에 통합합니다.

### 1.2 목표

1. PreToolUse `additionalContext` 활용으로 AI 컨텍스트 품질 향상
2. Task System 연동으로 PDCA 의존성 추적 강화
3. Keybindings 문서화로 사용자 생산성 향상

---

## 2. 기능 상세

### 2.1 PreToolUse additionalContext 활용 (우선순위: 높음)

**현재 상태**:
```javascript
// scripts/pre-write.js
console.log(JSON.stringify({ decision: "allow" }));
```

**개선안**:
```javascript
// scripts/pre-write.js (v1.5.0)
const response = {
  decision: "allow",
  additionalContext: generateContextHint(toolInput)
};
console.log(JSON.stringify(response));
```

**구현 항목**:
| 파일 | 변경 내용 |
|------|----------|
| `scripts/pre-write.js` | `additionalContext` 생성 로직 추가 |
| `scripts/pdca-pre-write.js` | PDCA 문서 타입별 컨텍스트 힌트 |
| `lib/common.js` | `generateContextHint()` 함수 추가 |

**컨텍스트 힌트 예시**:
```javascript
const CONTEXT_HINTS = {
  'plan.md': '이 파일은 PDCA Plan 문서입니다. 목표, 범위, 요구사항 섹션 구조를 유지하세요.',
  'design.md': '이 파일은 PDCA Design 문서입니다. API 스펙, 데이터 모델, 컴포넌트 구조를 포함하세요.',
  'analysis.md': '이 파일은 Gap Analysis 결과입니다. 매칭률과 이슈 목록을 정확히 기록하세요.'
};
```

---

### 2.2 Task System 연동 (우선순위: 중간)

**현재 상태**:
- bkit 자체 상태 관리: `docs/.pdca-status.json`
- Claude Code Task System과 별도 동작

**개선안**:
```javascript
// hooks/session-start.js (v1.5.0)
function syncPdcaToTasks() {
  const pdcaStatus = getPdcaStatusFull();

  for (const feature of pdcaStatus.activeFeatures) {
    const featureData = pdcaStatus.features[feature];

    // PDCA 단계별 Task 생성/업데이트
    emitTaskCreate({
      subject: `[${featureData.phase.toUpperCase()}] ${feature}`,
      description: `PDCA ${featureData.phase} 단계`,
      metadata: {
        pdcaPhase: featureData.phase,
        matchRate: featureData.matchRate
      }
    });
  }
}
```

**의존성 매핑**:
```
[Plan] login       → blockedBy: []
[Design] login     → blockedBy: [[Plan] login]
[Do] login         → blockedBy: [[Design] login]
[Check] login      → blockedBy: [[Do] login]
[Act] login        → blockedBy: [[Check] login] (matchRate < 90% 시)
```

---

### 2.3 Keybindings 문서화 (우선순위: 낮음)

**권장 Keybindings**:
```json
{
  "keybindings": [
    {
      "key": "ctrl+shift+p",
      "command": "/pdca-plan",
      "description": "PDCA Plan 문서 생성"
    },
    {
      "key": "ctrl+shift+d",
      "command": "/pdca-design",
      "description": "PDCA Design 문서 생성"
    },
    {
      "key": "ctrl+shift+a",
      "command": "/pdca-analyze",
      "description": "Gap 분석 실행"
    },
    {
      "key": "ctrl+shift+s",
      "command": "/pdca-status",
      "description": "PDCA 상태 확인"
    },
    {
      "key": "ctrl+shift+n",
      "command": "/pdca-next",
      "description": "다음 단계 안내"
    }
  ]
}
```

**문서화 항목**:
- `docs/guides/keybindings.md` 생성
- README.md에 keybindings 섹션 추가

---

## 3. 구현 우선순위

| 우선순위 | 기능 | 예상 복잡도 | 영향도 |
|----------|------|------------|--------|
| 1 | PreToolUse additionalContext | 낮음 | 높음 |
| 2 | Task System 연동 | 중간 | 중간 |
| 3 | Keybindings 문서화 | 낮음 | 낮음 |

---

## 4. 파일 변경 목록

### 신규 파일
- `docs/guides/keybindings.md`

### 수정 파일
- `scripts/pre-write.js` - additionalContext 로직
- `scripts/pdca-pre-write.js` - PDCA 문서 컨텍스트 힌트
- `lib/common.js` - 유틸리티 함수 추가
- `hooks/session-start.js` - Task System 동기화 (선택)
- `README.md` - keybindings 섹션 추가

---

## 5. 테스트 계획

### 5.1 additionalContext 테스트
```bash
# Plan 문서 작성 시 컨텍스트 힌트 확인
/pdca-plan test-feature
# → AI가 Plan 구조 가이드라인을 인식하는지 확인
```

### 5.2 Task System 테스트
```bash
# PDCA 상태와 Task 동기화 확인
/pdca-status
/tasks
# → 두 시스템의 상태가 일치하는지 확인
```

### 5.3 Keybindings 테스트
```bash
/keybindings
# → 권장 keybindings 설정 안내 확인
```

---

## 6. 완료 기준

- [ ] PreToolUse hooks에 additionalContext 반환 구현
- [ ] PDCA 문서 타입별 컨텍스트 힌트 정의
- [ ] Task System 동기화 로직 구현 (선택)
- [ ] Keybindings 가이드 문서 작성
- [ ] README.md 업데이트
- [ ] 모든 테스트 통과

---

## 7. 리스크 및 고려사항

### 7.1 하위 호환성
- additionalContext는 선택적 필드로 기존 동작에 영향 없음
- Task System 연동은 선택적 기능으로 구현

### 7.2 성능
- additionalContext 생성은 경량 문자열 처리만 수행
- Task System 동기화는 세션 시작 시 1회만 실행

---

## 다음 단계

1. 이 Plan 승인 후 → `/pdca-design v1.5.0-claude-code-2.1.19-integration`
2. Design 완료 후 → 구현 시작
3. 구현 완료 후 → `/pdca-analyze` Gap 분석
